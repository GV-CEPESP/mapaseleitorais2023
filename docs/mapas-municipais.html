<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Parte 3 Mapas municipais | Mapas Eleitorais com R</title>
  <meta name="description" content="Parte 3 Mapas municipais | Mapas Eleitorais com R" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Parte 3 Mapas municipais | Mapas Eleitorais com R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Parte 3 Mapas municipais | Mapas Eleitorais com R" />
  
  
  

<meta name="author" content="Lucas Gelape, João V. Guedes-Neto e Marco Antonio Faganello" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="meu-primeiro-mapa.html"/>
<link rel="next" href="atividades-extras.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mapas Eleitorais com R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Sobre o Workshop</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#informações-básicas"><i class="fa fa-check"></i><b>1.1</b> Informações básicas</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pré-requisitos"><i class="fa fa-check"></i><b>1.2</b> Pré-Requisitos</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#autores"><i class="fa fa-check"></i><b>1.3</b> Autores</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#como-citar"><i class="fa fa-check"></i><b>1.3.1</b> Como citar</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="meu-primeiro-mapa.html"><a href="meu-primeiro-mapa.html"><i class="fa fa-check"></i><b>2</b> Meu Primeiro Mapa</a>
<ul>
<li class="chapter" data-level="2.1" data-path="meu-primeiro-mapa.html"><a href="meu-primeiro-mapa.html#a-eleição-presidencial-de-2014"><i class="fa fa-check"></i><b>2.1</b> A Eleição Presidencial de 2014</a></li>
<li class="chapter" data-level="2.2" data-path="meu-primeiro-mapa.html"><a href="meu-primeiro-mapa.html#a-eleição-presidencial-de-2022"><i class="fa fa-check"></i><b>2.2</b> A Eleição Presidencial de 2022</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mapas-municipais.html"><a href="mapas-municipais.html"><i class="fa fa-check"></i><b>3</b> Mapas municipais</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mapas-municipais.html"><a href="mapas-municipais.html#organização-intramunicipal"><i class="fa fa-check"></i><b>3.1</b> Organização Intramunicipal</a></li>
<li class="chapter" data-level="3.2" data-path="mapas-municipais.html"><a href="mapas-municipais.html#importação-das-bases"><i class="fa fa-check"></i><b>3.2</b> Importação das Bases</a></li>
<li class="chapter" data-level="3.3" data-path="mapas-municipais.html"><a href="mapas-municipais.html#preparação-do-banco-de-dados"><i class="fa fa-check"></i><b>3.3</b> Preparação do Banco de Dados</a></li>
<li class="chapter" data-level="3.4" data-path="mapas-municipais.html"><a href="mapas-municipais.html#visualização-do-mapa"><i class="fa fa-check"></i><b>3.4</b> Visualização do mapa</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="atividades-extras.html"><a href="atividades-extras.html"><i class="fa fa-check"></i><b>4</b> Atividades Extras</a>
<ul>
<li class="chapter" data-level="4.1" data-path="atividades-extras.html"><a href="atividades-extras.html#marta-suplicy-em-2000"><i class="fa fa-check"></i><b>4.1</b> Marta Suplicy em 2000</a></li>
<li class="chapter" data-level="4.2" data-path="atividades-extras.html"><a href="atividades-extras.html#eduardo-paes-em-2020"><i class="fa fa-check"></i><b>4.2</b> Eduardo Paes em 2020</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="apêndice.html"><a href="apêndice.html"><i class="fa fa-check"></i><b>5</b> Apêndice</a>
<ul>
<li class="chapter" data-level="5.1" data-path="apêndice.html"><a href="apêndice.html#resultados-eleitorais"><i class="fa fa-check"></i><b>5.1</b> Resultados Eleitorais</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="apêndice.html"><a href="apêndice.html#são-paulo-em-2020"><i class="fa fa-check"></i><b>5.1.1</b> São Paulo em 2020</a></li>
<li class="chapter" data-level="5.1.2" data-path="apêndice.html"><a href="apêndice.html#rio-de-janeiro-em-2020"><i class="fa fa-check"></i><b>5.1.2</b> Rio de Janeiro em 2020</a></li>
<li class="chapter" data-level="5.1.3" data-path="apêndice.html"><a href="apêndice.html#são-paulo-em-2000"><i class="fa fa-check"></i><b>5.1.3</b> São Paulo em 2000</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="apêndice.html"><a href="apêndice.html#locais-de-votação"><i class="fa fa-check"></i><b>5.2</b> Locais de Votação</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="apêndice.html"><a href="apêndice.html#são-paulo-em-2020-1"><i class="fa fa-check"></i><b>5.2.1</b> São Paulo em 2020</a></li>
<li class="chapter" data-level="5.2.2" data-path="apêndice.html"><a href="apêndice.html#rio-de-janeiro-em-2020-1"><i class="fa fa-check"></i><b>5.2.2</b> Rio de Janeiro em 2020</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="apêndice.html"><a href="apêndice.html#divisões-administrativas"><i class="fa fa-check"></i><b>5.3</b> Divisões Administrativas</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="apêndice.html"><a href="apêndice.html#distritos-de-são-paulo"><i class="fa fa-check"></i><b>5.3.1</b> Distritos de São Paulo</a></li>
<li class="chapter" data-level="5.3.2" data-path="apêndice.html"><a href="apêndice.html#rio-de-janeiro"><i class="fa fa-check"></i><b>5.3.2</b> Rio de Janeiro</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="apêndice.html"><a href="apêndice.html#informações-da-sessão"><i class="fa fa-check"></i><b>5.4</b> Informações da sessão</a></li>
</ul></li>
<li class="divider"></li>
<li><b><a href="https://www.cepesp.io" target="blank">FGV CEPESP</a></b></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mapas Eleitorais com R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mapas-municipais" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Parte 3</span> Mapas municipais<a href="mapas-municipais.html#mapas-municipais" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="organização-intramunicipal" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Organização Intramunicipal<a href="mapas-municipais.html#organização-intramunicipal" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Administrativamente, a Justiça Eleitoral se organiza em zonas eleitorais, nas quais estão localizados os locais de votação, que abrigam as seções eleitorais (sendo que cada seção eleitoral corresponde a uma urna). Dentro dos municípios, porém, a organização territorial da Justiça Eleitoral não coincide necessariamente com outras divisões administrativas. Ou seja, os limites das zonas eleitorais muitas vezes não correspondem aos limites de bairros ou distritos.</p>
<p>Além disso, os Tribunais Regionais Eleitorais (TREs) não têm o costume de divulgar arquivos espaciais que apresentem os limites dessas zonas. Então, como produzir mapas de resultados eleitorais dentro de municípios?</p>
<p>Para isso, utilizamos outra fonte de dados do Tribunal Superior Eleitoral (TSE). O TSE divulga os endereços de todos os locais de votação brasileiros e as suas seções eleitorais correspondentes de todas as disputas desde 2008 (alguns TREs divulgam essas informações para eleições prévias a 2008) e podem ser usadas para esse fim. Esses registros administrativos têm, inclusive, uma coluna com a informação de bairro desse endereço.</p>
<p>Bastaria então unir o banco de resultados por seção eleitoral com esse de locais de votação, somar os votos no bairro informado pela coluna dos registros do TSE, acoplar os resultados num mapa e pronto, certo? Infelizmente, não. A informação do bairro advinda dos registros do TSE frequentemente não coincide com o bairro onde geograficamente está esse local de votação (para mais informações, veja Gelape, <a href="https://repositorio.ufmg.br/handle/1843/BUOS-AQGERZ">2017</a>, <a href="https://medium.com/@lgelape/representa%C3%A7%C3%A3o-territorial-e-marielle-franco-b1884061bf1c">2018</a>).</p>
<p>Assim, para produzirmos mapas com votações de candidatos dentro de um município, precisamos encontrar a localização dos locais de votação no espaço. Neste exercício, utilizamos um banco de dados disponibilizado pelo prof. Daniel Hidalgo (do Massachusetts Institute of Technology, MIT) que cataloga a latitude e longitude para os locais de votação brasileiros entre 2006 e 2020. Esse foi um esforço de pesquisa que cruzou diferentes fontes de dados para determinar as coordenadas geográficas e que contou com a participação do FGV-CEPESP (para mais informações, deem uma olhada no <a href="https://github.com/fdhidalgo/geocode_br_polling_stations">repositório do GitHub</a> – e na <a href="https://raw.githack.com/fdhidalgo/geocode_br_polling_stations/master/doc/geocoding_procedure.html">documentação da metodologia</a> deste processo). Com a latitude e longitude, podemos cruzar essa informação espacial com outra(s) informações espaciais, como um mapa de bairros de um município, para passar aos nossos pontos (isto é, os locais de votação) tais informações.</p>
</div>
<div id="importação-das-bases" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Importação das Bases<a href="mapas-municipais.html#importação-das-bases" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Neste exercício, prepararemos um mapa da cidade de São Paulo contendo os dados de votação por seção eleitoral do candidato a prefeito Guilherme Boulos (PSOL) em 2020.</p>
<p>Nosso primeiro passo, como no exercício anterior, será carregar os pacotes relevantes para a nossa análise. O pacote <code>tidyverse</code> carrega diversos pacotes importantes, como alguns já utilizados anteriormente, como o <code>ggplot2</code> e o <code>dplyr</code>. Também carregamos novamente os pacotes <code>sf</code> e <code>geobr</code>. Temos, no entanto, três novidades. Primeiro, o <code>ggspatial</code> nos ajudar a plotar mapas mais detalhados (de certa maneira, ele é utilizado em conjunto com o <code>ggplot2</code>). O <code>classInt</code> nos ajuda a dividir distribuições de dados, para preparar escalas de cores de um mapa, por exemplo. Por fim, o pacote <code>cartography</code> ajuda a produzir mapas temáticos, com mais funcionalidades para essa tarefa.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="mapas-municipais.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-2"><a href="mapas-municipais.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-3"><a href="mapas-municipais.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geobr)</span>
<span id="cb11-4"><a href="mapas-municipais.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb11-5"><a href="mapas-municipais.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb11-6"><a href="mapas-municipais.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartography)</span></code></pre></div>
<p>Agora que já temos os pacotes carregados, vamos baixar os bancos de dados (todos preparados em formato <em>RDS</em>). Em primeiro lugar, baixamos a base de dados contendo dados de votacao por secao eleitoral do candidato a prefeito Guilherme Boulos (PSOL), e dos candidatos a vereador Milton Leite (DEM), Fernando Holiday (PATRIOTA) e Eduardo Suplicy (PT). Ela está salva como <em>base2020.rds</em>.</p>
<p>Para facilitar nossa análise, aproveitamos o mesmo bloco de código para encurtar os nomes de cada um destes candidatos. Para tal, utilizamos as funções <em>mutate</em> e <em>case_when</em> do pacote <em>dplyr</em>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="mapas-municipais.html#cb12-1" aria-hidden="true" tabindex="-1"></a>candsp2020 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;base/base2020_sp.rds&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="mapas-municipais.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nm_votavel =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-3"><a href="mapas-municipais.html#cb12-3" aria-hidden="true" tabindex="-1"></a>    nm_votavel <span class="sc">==</span> <span class="st">&quot;MILTON LEITE DA SILVA&quot;</span> <span class="sc">~</span> <span class="st">&quot;Milton Leite&quot;</span>,</span>
<span id="cb12-4"><a href="mapas-municipais.html#cb12-4" aria-hidden="true" tabindex="-1"></a>    nm_votavel <span class="sc">==</span> <span class="st">&quot;GUILHERME CASTRO BOULOS&quot;</span> <span class="sc">~</span> <span class="st">&quot;Boulos&quot;</span>,</span>
<span id="cb12-5"><a href="mapas-municipais.html#cb12-5" aria-hidden="true" tabindex="-1"></a>    nm_votavel <span class="sc">==</span> <span class="st">&quot;EDUARDO MATARAZZO SUPLICY&quot;</span> <span class="sc">~</span> <span class="st">&quot;Suplicy&quot;</span>,</span>
<span id="cb12-6"><a href="mapas-municipais.html#cb12-6" aria-hidden="true" tabindex="-1"></a>    nm_votavel <span class="sc">==</span> <span class="st">&quot;FERNANDO HOLIDAY SILVA BISPO&quot;</span> <span class="sc">~</span> <span class="st">&quot;Holiday&quot;</span>))</span></code></pre></div>
<p>Para se ter ideia de seu conteúdo, apresentamos sua <code>head</code> abaixo. São 28 colunas (variáveis) e 80.984 linhas (observações) contendo o número de votos que cada um dos três candidatos obteve na eleição de 2020, sendo Boulos para prefeito e os demais para vereador.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="mapas-municipais.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(candsp2020)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##   dt_geracao ano_eleicao nr_turno sg_uf nm_municipio cd_munic…¹ nr_zona nr_se…² nr_lo…³ ds_ca…⁴ nm_vo…⁵ qt_vo…⁶ votos…⁷
##   &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 21/12/2020        2020        1 SP    SÃO PAULO         71072     408     242    1180 Veread… Suplicy       3     258
## 2 21/12/2020        2020        1 SP    SÃO PAULO         71072     346     408    1309 Veread… Milton…       2     270
## 3 21/12/2020        2020        1 SP    SÃO PAULO         71072     346     408    1309 Veread… Holiday       4     270
## 4 21/12/2020        2020        1 SP    SÃO PAULO         71072     408     255    1198 Veread… Suplicy       3     250
## 5 21/12/2020        2020        1 SP    SÃO PAULO         71072     408     255    1198 Veread… Holiday       3     250
## 6 21/12/2020        2020        1 SP    SÃO PAULO         71072     408     255    1198 Prefei… Boulos       55     248
## # … with abbreviated variable names ¹​cd_municipio, ²​nr_secao, ³​nr_local_votacao, ⁴​ds_cargo, ⁵​nm_votavel, ⁶​qt_votos,
## #   ⁷​votos_validos_secao</code></pre>
<p>Nosso próximo passo é carregar a base com dados geolocalizados de cada um dos locais de votação no município de São Paulo. Seu nome é <code>lvsp2020.rds</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="mapas-municipais.html#cb15-1" aria-hidden="true" tabindex="-1"></a>lvsp2020 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;base/lvsp2020.rds&quot;</span>)</span></code></pre></div>
<p>Ao abrir esta base de dados, você verá o endereço de cada local de votação (por ex., o Colégio Objetivo na Av. Paulista, 900, Bela Vista), acompanhado de sua longitude e latitude, além de outros dados espaciais. A base possui 2.063 observações e 19 variáveis.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="mapas-municipais.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lvsp2020)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 19
##   local_id   ano sg_uf cd_loca…¹ cod_l…² nr_zona nr_lo…³ nr_cep nm_lo…⁴ nm_lo…⁵ ds_en…⁶ ds_ba…⁷ pred_…⁸ pred_…⁹ pred_…˟
##      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1   678500  2020 SP        71072 3550308       1    1015 1.31e6 SÃO PA… COLÉGI… AV. PA… BELA V…   -46.7   -23.6    1.60
## 2   670114  2020 SP        71072 3550308       2    1015 5.00e6 SÃO PA… COLÉGI… AV. FR… AGUA B…   -46.7   -23.5    1.76
## 3   688691  2020 SP        71072 3550308       4    1015 3.10e6 SÃO PA… EE. PR… RUA DA… MOOCA     -46.6   -23.6    1.61
## 4   694622  2020 SP        71072 3550308       5    1015 1.43e6 SÃO PA… CLUBE … RUA ES… JARDIM…   -46.7   -23.6    2.31
## 5   696661  2020 SP        71072 3550308       6    1015 4.12e6 SÃO PA… EE. MA… RUA DO… VILA M…   -46.6   -23.6    0   
## 6   674162  2020 SP        71072 3550308     246    1015 4.75e6 SÃO PA… EE. PR… AVENID… SANTO …   -46.7   -23.7    0   
## # … with 4 more variables: tse_lat &lt;dbl&gt;, tse_long &lt;dbl&gt;, long &lt;dbl&gt;, lat &lt;dbl&gt;, and abbreviated variable names
## #   ¹​cd_localidade_tse, ²​cod_localidade_ibge, ³​nr_locvot, ⁴​nm_localidade, ⁵​nm_locvot, ⁶​ds_endereco, ⁷​ds_bairro,
## #   ⁸​pred_long, ⁹​pred_lat, ˟​pred_dist</code></pre>
<p>Nosso próximo passo será converter os dados de longitude (<em>long</em>) e latitude (<em>lat</em>) utilizando o pacote <code>sf</code> em um objeto de <em>features espaciais</em>. Isto é importante para compatibilizar a estrutura dos dados com os pacotes e mapas com os quais estamos trabalhando. Mais especificamente, a transformação tem por objetivo utilizar transformar esses dados tabulares em dados espaciais, produzidos com base no sistema de referência de coordenadas (CRS) geográficas SIRGAS 2000. Este passo é padrão para a elaboração da maioria dos mapas brasileiros.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="mapas-municipais.html#cb18-1" aria-hidden="true" tabindex="-1"></a>lvsp2020 <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a href="mapas-municipais.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  lvsp2020 <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="mapas-municipais.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertendo o dataframe &#39;lvsp2020&#39; em um objeto de features espaciais (&#39;sf&#39;)</span></span>
<span id="cb18-4"><a href="mapas-municipais.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(</span>
<span id="cb18-5"><a href="mapas-municipais.html#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>), <span class="co"># Define as colunas &#39;long&#39; e &#39;lat&#39; como coordenadas</span></span>
<span id="cb18-6"><a href="mapas-municipais.html#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4674</span>                 <span class="co"># Define o sistema de referência de coordenadas (CRS) como 4674 - SIRGAS 2000</span></span>
<span id="cb18-7"><a href="mapas-municipais.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Pronto! Já temos os locais de votação e quantos votos os candidatos obtiveram em cada um urna. Temos, no entanto, um desafio. Havíamos falado que a Justiça Eleitoral se organiza por zonas eleitorais mas os limites destas zonas geralmente não são divulgados pelos TREs (e aquele bairro informado nos dados não necessariamente corresponde à divisão administrativa da cidade!). O que nós faremos, então, é utilizar outra delimitação espacial como “aproximação” para apresentar a distribuição dos votos no município de São Paulo. Uma estratégia possível é identificar o distrito (a menor agregação administrativa oficial do município de São Paulo) onde se encontra cada local de votação dessa cidade. Na base de dados <em>mapas_distritos_sp.rds</em> temos os mapas dos 96 distritos deste município. Por isso, iremos carregá-la agora.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="mapas-municipais.html#cb19-1" aria-hidden="true" tabindex="-1"></a>mapa <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;base/mapa_distritos_sp.rds&quot;</span>)</span></code></pre></div>
<p>Esta base se parece com aquelas que chamamos de <em>mapa_brasil</em> na parte anterior deste workshop. Para cada um dos distritos (coluna <em>name_district</em>), ela possui uma coluna chamada <em>geom</em> com a informação do polígono que representa o território do distrito. Veja abaixo como fica um mapa simples no qual utilizamos estes polígonos para plotar os distritos na cidade de São Paulo.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="mapas-municipais.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-visualização do mapa de distritos de Sao Paulo usando ggplot2</span></span>
<span id="cb20-2"><a href="mapas-municipais.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mapa) <span class="sc">+</span></span>
<span id="cb20-3"><a href="mapas-municipais.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adiciona camadas de features espaciais ao gráfico</span></span>
<span id="cb20-4"><a href="mapas-municipais.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="fake-book_files/figure-html/mapa-sp-1.png" width="672" /></p>
<p>Agora, vamos visualizar onde fica cada um dos locais de votação do município de São Paulo. No código abaixo, utilizamos o <code>ggplot2</code> para plotar o mapa com os distritos. Depois, com o comando <code>geom_sf(data = lvsp2020)</code>, adicionamos uma nova camada ao nosso <em>plot</em>, agora com os locais de votação. Por fim, o <code>theme_void()</code> ajusta o layout do gráfico para facilitar a visualização.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="mapas-municipais.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mapa) <span class="sc">+</span> <span class="co"># Gera gráfico utilizando a base mapa</span></span>
<span id="cb21-2"><a href="mapas-municipais.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="co"># Transforma em gráfico geoespacial</span></span>
<span id="cb21-3"><a href="mapas-municipais.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lvsp2020) <span class="sc">+</span> <span class="co"># Adiciona camada com pontos dos locais de votação</span></span>
<span id="cb21-4"><a href="mapas-municipais.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="co"># Ajusta o layout do gráfico deixando a tela de fundo em branco</span></span></code></pre></div>
<p><img src="fake-book_files/figure-html/mapa-sp-locais-1.png" width="672" /></p>
</div>
<div id="preparação-do-banco-de-dados" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Preparação do Banco de Dados<a href="mapas-municipais.html#preparação-do-banco-de-dados" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Na etapa anterior, visualizamos alguns dos dados que utilizaremos para produzir alguns dos mapas eleitorais desse workshop. A partir de agora, vamos preparar os dados do candidato Guilherme Boulos para visualizar a sua votação por distritos de São Paulo.</p>
<p>O primeiro passo será gerar uma base <code>candsp2020_porlv</code> na qual mantemos apenas o candidato Boulos e somamos a quantidade de votos obtidas em todas as urnas de cada local de votação. Note que você pode realizar o mesmo procedimento para outros candidatos. Para tal, basta substituir “Boulos” pelo nome do seu candidato de escolha. Lembre-se que as possibilidades nesse workshop são Milton Leite, Suplicy e Holiday.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="mapas-municipais.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula votos por local de votacao</span></span>
<span id="cb22-2"><a href="mapas-municipais.html#cb22-2" aria-hidden="true" tabindex="-1"></a>candsp2020_porlv <span class="ot">&lt;-</span> candsp2020 <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="mapas-municipais.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtra somente pelo Boulos</span></span>
<span id="cb22-4"><a href="mapas-municipais.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nm_votavel <span class="sc">==</span> <span class="st">&quot;Boulos&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="mapas-municipais.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Soma os votos do candidato e total da urna por local de votacao</span></span>
<span id="cb22-6"><a href="mapas-municipais.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nr_zona, nr_local_votacao, nm_votavel) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="mapas-municipais.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">votos_cand =</span> <span class="fu">sum</span>(qt_votos),</span>
<span id="cb22-8"><a href="mapas-municipais.html#cb22-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">votos_validos =</span> <span class="fu">sum</span>(votos_validos_secao)) <span class="sc">|&gt;</span></span>
<span id="cb22-9"><a href="mapas-municipais.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-10"><a href="mapas-municipais.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcula o percencual de votos por local</span></span>
<span id="cb22-11"><a href="mapas-municipais.html#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votos_cand_porc =</span> <span class="fu">round</span>(votos_cand<span class="sc">/</span>votos_validos<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)) </span></code></pre></div>
<p>No exercício do mapa do Brasil, utilizamos o comando <em>left_join</em> para integrar a base de dados com os ganhadores em cada estado com a base que possuia os polígonos de cada estado (a coluna <em>geom</em>). Agora faremos algo muito parecido. Integraremos a base que acabamos de criar (<em>candsp2020_porlv</em>) a base que possui os locais de votação (<em>lvsp2020</em>). Para tal, também renomeamos o <em>nr_local_votacao</em> para <em>nr_locvot</em> a fim de assegurar que esta coluna tem o mesmo nome em ambas as bases. Por fim, transformamos as informações em objeto espacial com a função <em>st_as_sf</em>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="mapas-municipais.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Une com a base de LV geolocalizado </span></span>
<span id="cb23-2"><a href="mapas-municipais.html#cb23-2" aria-hidden="true" tabindex="-1"></a>candsp2020_porlv <span class="ot">&lt;-</span> candsp2020_porlv <span class="sc">|&gt;</span>   </span>
<span id="cb23-3"><a href="mapas-municipais.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Renomeia a variavel nr_local_votacao para facilitar o join</span></span>
<span id="cb23-4"><a href="mapas-municipais.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nr_locvot =</span> nr_local_votacao) <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="mapas-municipais.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Traz a informacao da base de LV geolocalizado</span></span>
<span id="cb23-6"><a href="mapas-municipais.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lvsp2020, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;nr_zona&quot;</span>, <span class="st">&quot;nr_locvot&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb23-7"><a href="mapas-municipais.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transforma em objeto espacial</span></span>
<span id="cb23-8"><a href="mapas-municipais.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">sf_column_name =</span> <span class="st">&quot;geometry&quot;</span>)</span></code></pre></div>
<p>Pronto! Agora vamos gerar nosso primeiro mapa para pré-visualizar o que fizemos até aqui. A função é muito parecida com as que já utilizamos nos exercícios anteriores. O <code>ggplot()</code> carrega o gráfico, o primeiro <code>geom_sf()</code> informa a base com os polígonos e, na linha seguinte, informa que a coluna <em>votos_cand_porc</em> deve ser utilizada para estimar o tamanho (<em>size</em>) do pontos (quanto mais votos, maiores serão) e a cor (<em>color</em>) dos pontos (quanto mais votos, mais claro é a tonalidade do azul).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="mapas-municipais.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pré-visualização dos votos dos candidatos por local de votação</span></span>
<span id="cb24-2"><a href="mapas-municipais.html#cb24-2" aria-hidden="true" tabindex="-1"></a>candsp2020_porlv <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="mapas-municipais.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nm_votavel <span class="sc">==</span> <span class="st">&quot;Boulos&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="mapas-municipais.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-5"><a href="mapas-municipais.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>mapa)<span class="sc">+</span></span>
<span id="cb24-6"><a href="mapas-municipais.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">size=</span>votos_cand_porc, <span class="at">color=</span>votos_cand_porc))<span class="sc">+</span></span>
<span id="cb24-7"><a href="mapas-municipais.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="fake-book_files/figure-html/candidatos-local-1.png" width="672" /></p>
<p>Note que neste mapa, os locais de votação estão em sua localização original. Ainda não geramos uma base na qual eles são inseridos dentro dos distritos. Para tal, utilizaremos o comando <code>st_join()</code> (<em>spatial join</em>) para integrar a base de locais de votação (<em>lvsp2020</em>) ao <em>mapa</em>.</p>
<p>A função <code>st_join()</code> realiza um procedimento semelhante a um <code>left_join()</code>. Porém, ao invés de termos uma “variável-chave” que permitirá combinar as bases, a variável-chave é a sua localização no espaço! Ou seja, no exemplo abaixo, <code>lvsp2020_distrito</code> será um objeto espacial em que cada linha é um local de votação (ponto) ao qual foram adicionadas novas colunas, cujos valores se referem ao distrito (polígono) no qual ele se encontra.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="mapas-municipais.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Faz o spatial join</span></span>
<span id="cb25-2"><a href="mapas-municipais.html#cb25-2" aria-hidden="true" tabindex="-1"></a>lvsp2020_distrito <span class="ot">&lt;-</span> <span class="fu">st_join</span>(lvsp2020, mapa)</span></code></pre></div>
<p>Existe, no entanto, um cuidado. Lembre-se que estamos fazendo uma reposição “artificial”. Isto é, os locais de votação não foram feitos para se enquadrarem perfeitamente nos distritos de São Paulo. O TRE tem sua própria distribuição espacial que não necessariamente bate com aquela do IBGE. Utilizando o comando <code>nrow()</code>, verificamos que a base <em>lvsp2020_distrito</em> tem uma linha a mais que a base <em>lvsp2020</em>! Ou seja, 2.064 linhas comparado com 2.063.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="mapas-municipais.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(lvsp2020)</span></code></pre></div>
<pre><code>## [1] 2063</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="mapas-municipais.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(lvsp2020_distrito) <span class="co"># Ele tem uma linha a mais!</span></span></code></pre></div>
<pre><code>## [1] 2064</code></pre>
<p>O gráfico que geramos abaixo nos auxilia na identificação do problema. Existe um local de votação que está localizado exatamente na divisa entre Vila Mariana e Bela Vista. Por isso, os nosso trabalho de integrar bases de dados acabou gerando o mesmo local de votação duas vezes – uma para cada bairro.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="mapas-municipais.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Isso ocorreu porque um LV está bem na divisa entre dois distritos</span></span>
<span id="cb30-2"><a href="mapas-municipais.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-3"><a href="mapas-municipais.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>mapa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name_district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Vila Mariana&quot;</span>, <span class="st">&quot;Bela Vista&quot;</span>)))<span class="sc">+</span></span>
<span id="cb30-4"><a href="mapas-municipais.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lvsp2020 <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">269</span>), <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb30-5"><a href="mapas-municipais.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="fake-book_files/figure-html/identificando%20o%20problema-1.png" width="672" /></p>
<p>Existem várias soluções possíveis para este problema. Perceba que não necessariamente existirá a solução perfeita para todos os casos. É necessário refletir sobre o objetivo da análise. Primeiro, poderíamos escolher aleatoriamente onde colocar este local de votação (Vila Mariana ou Bela Vista). Copiamos abaixo o bloco de código que permitirá realizar esta modificação.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="mapas-municipais.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Possivel solução: selecionar aleatoriamente o bairro ao qual ele esta atribuido</span></span>
<span id="cb31-2"><a href="mapas-municipais.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#lvsp2020_distrito &lt;- lvsp2020_distrito |&gt; </span></span>
<span id="cb31-3"><a href="mapas-municipais.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  group_by(nr_locvot, nr_zona) |&gt; </span></span>
<span id="cb31-4"><a href="mapas-municipais.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  slice_sample(n = 1) |&gt; </span></span>
<span id="cb31-5"><a href="mapas-municipais.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  ungroup() |&gt; </span></span>
<span id="cb31-6"><a href="mapas-municipais.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  # Seleciona so as variaveis que vamos usar para o mapa</span></span>
<span id="cb31-7"><a href="mapas-municipais.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(nr_zona, nr_locvot, name_district) |&gt; </span></span>
<span id="cb31-8"><a href="mapas-municipais.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  # Retira a geometria, para ela ser tratada como uma tabela</span></span>
<span id="cb31-9"><a href="mapas-municipais.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  st_drop_geometry()</span></span>
<span id="cb31-10"><a href="mapas-municipais.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#nrow(lvsp2020_distrito) # 2.063 linhas, pronto!</span></span></code></pre></div>
<p>Para este exercício, selecionamos uma outra solução. Decidimos criar um comando geral que faz com que sempre que existirem mais de um ponto, o primeiro deles será escolhido.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="mapas-municipais.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Escolher o primeiro ponto</span></span>
<span id="cb32-2"><a href="mapas-municipais.html#cb32-2" aria-hidden="true" tabindex="-1"></a>lvsp2020_distrito <span class="ot">&lt;-</span> lvsp2020_distrito <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="mapas-municipais.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nr_locvot, nr_zona) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="mapas-municipais.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="mapas-municipais.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="mapas-municipais.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seleciona so as variaveis que vamos usar para o mapa</span></span>
<span id="cb32-7"><a href="mapas-municipais.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nr_zona, nr_locvot, name_district) <span class="sc">|&gt;</span> </span>
<span id="cb32-8"><a href="mapas-municipais.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retira a geometria, para ela ser tratada como uma tabela</span></span>
<span id="cb32-9"><a href="mapas-municipais.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb32-10"><a href="mapas-municipais.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#nrow(lvsp2020_distrito) # 2.063 linhas, pronto!</span></span></code></pre></div>
<p>Da mesma forma que criamos uma base com votos por local de votação (<em>candsp2020_porlv</em>), agora criamos uma base que terá os votos por distrito (<em>candsp2020_pordist</em>). Lembre-se que isto foi possível porque compatibilizamos ambas as localizações geográficas.</p>
<p>Para melhorar a visualização dos dados, calculamos na coluna <em>votos_cand_porc</em> a porcentagem dos votos que o candidato Boulos recebeu em cada distrito.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="mapas-municipais.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># agregação dos votos nos locais de votação por distrito</span></span>
<span id="cb33-2"><a href="mapas-municipais.html#cb33-2" aria-hidden="true" tabindex="-1"></a>candsp2020_pordist <span class="ot">&lt;-</span> candsp2020_porlv <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="mapas-municipais.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retira a informacao da geometria dos pontos</span></span>
<span id="cb33-4"><a href="mapas-municipais.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-5"><a href="mapas-municipais.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Traz a informacao do distrito referente ao ponto, que obtivemos acima</span></span>
<span id="cb33-6"><a href="mapas-municipais.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lvsp2020_distrito, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;nr_zona&quot;</span>, <span class="st">&quot;nr_locvot&quot;</span>))</span>
<span id="cb33-7"><a href="mapas-municipais.html#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="mapas-municipais.html#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Soma os votos do candidato por distrito e calcula o %</span></span>
<span id="cb33-9"><a href="mapas-municipais.html#cb33-9" aria-hidden="true" tabindex="-1"></a>candsp2020_pordist <span class="ot">&lt;-</span> candsp2020_pordist <span class="sc">|&gt;</span> </span>
<span id="cb33-10"><a href="mapas-municipais.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name_district, nm_votavel) <span class="sc">|&gt;</span></span>
<span id="cb33-11"><a href="mapas-municipais.html#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">votos_cand =</span> <span class="fu">sum</span>(votos_cand),</span>
<span id="cb33-12"><a href="mapas-municipais.html#cb33-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">votos_validos =</span> <span class="fu">sum</span>(votos_validos)) <span class="sc">|&gt;</span> </span>
<span id="cb33-13"><a href="mapas-municipais.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb33-14"><a href="mapas-municipais.html#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">votos_cand_porc =</span> <span class="fu">round</span>(votos_cand<span class="sc">/</span>votos_validos<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)) </span></code></pre></div>
<p>Por fim, geramos um objeto espacial integrando com o comando <em>left_join</em> a base geoespacial <em>mapa</em> à base eleitoral <em>candsp2020_pordist</em> com base na coluna <em>name_district</em> que define o nome dos distritos. Ou seja, queremos saber associar a votação de Boulos em cada distrito a um objeto com as informações espaciais desses distritos.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="mapas-municipais.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria um objeto espacial em que passamos para o mapa a votacao</span></span>
<span id="cb34-2"><a href="mapas-municipais.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># de Boulos em cada um dos distritos de SP</span></span>
<span id="cb34-3"><a href="mapas-municipais.html#cb34-3" aria-hidden="true" tabindex="-1"></a>boulos_final <span class="ot">&lt;-</span> <span class="fu">left_join</span>(mapa, candsp2020_pordist, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;name_district&quot;</span>))</span></code></pre></div>
<p>Pronto! Agora já podemos pré-visualizar o mapa de votação do Boulos por distrito de São Paulo! Mais uma vez, utilizamos o comando <code>ggplot()</code> para gerar o gráfico e, dentro do comando <code>geom_sf</code>, utilizamos o argumento <code>fill</code> para preencher cada distrito com tonalidades diferentes de acordo com a porcentagem de votos obtida pelo candidato selecionado (<em>votos_cand_porc</em>).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="mapas-municipais.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pré-visualização dos votos dos candidatos por distrito</span></span>
<span id="cb35-2"><a href="mapas-municipais.html#cb35-2" aria-hidden="true" tabindex="-1"></a>boulos_final <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="mapas-municipais.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="mapas-municipais.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> votos_cand_porc)) <span class="sc">+</span></span>
<span id="cb35-5"><a href="mapas-municipais.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="fake-book_files/figure-html/mapa-boulos-1.png" width="672" /></p>
</div>
<div id="visualização-do-mapa" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Visualização do mapa<a href="mapas-municipais.html#visualização-do-mapa" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Por fim, vamos melhorar substancialmente diversos aspectos do nosso mapa. Existem diversas escalas para definir os cortes de uma variável, que vão informar como colorir áreas de um mapa. Para mais informações, veja este vídeo no <a href="https://www.youtube.com/watch?v=0ebL8OvG8Jc">YouTube</a>. Ele está em inglês, mas é possível gerar legendas traduzidas automaticamente.</p>
<p>Vejamos como ao escolher duas delas, e produziremos dois mapas que <em>sugerem</em> informações diferentes fundamentados na mesma base de dados. Testaremos abaixo a abordagem de Cortes de Jenks (<em>jenks</em>) e Intervalos Geogmétricos (<em>geom</em>).</p>
<p>O corte de <em>jenks</em> é feito com o pacote <code>classIntervals</code>. Note que ao fim do comando, identificamos o tipo de corte.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="mapas-municipais.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria os cortes e os guardamos em um objeto</span></span>
<span id="cb36-2"><a href="mapas-municipais.html#cb36-2" aria-hidden="true" tabindex="-1"></a>cortes <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(boulos_final<span class="sc">$</span>votos_cand_porc, <span class="dv">4</span>, <span class="st">&quot;jenks&quot;</span>)</span>
<span id="cb36-3"><a href="mapas-municipais.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="mapas-municipais.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria uma variável com os cortes</span></span>
<span id="cb36-5"><a href="mapas-municipais.html#cb36-5" aria-hidden="true" tabindex="-1"></a>boulos_final<span class="sc">$</span>cortes_jenks <span class="ot">&lt;-</span> <span class="fu">cut</span>(boulos_final<span class="sc">$</span>votos_cand_porc, cortes<span class="sc">$</span>brks, </span>
<span id="cb36-6"><a href="mapas-municipais.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">include.lowest =</span> T)</span></code></pre></div>
<p>Agora realizamos um procedimento muito parecido para gerar os intervalos geométricos. Para tal, substituímos <em>jenks</em> por <em>geom</em>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="mapas-municipais.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria os cortes e os guardamos em um objeto</span></span>
<span id="cb37-2"><a href="mapas-municipais.html#cb37-2" aria-hidden="true" tabindex="-1"></a>cortes <span class="ot">&lt;-</span> <span class="fu">getBreaks</span>(boulos_final<span class="sc">$</span>votos_cand_porc, <span class="dv">4</span>, <span class="st">&quot;geom&quot;</span>)</span>
<span id="cb37-3"><a href="mapas-municipais.html#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="mapas-municipais.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Insere os cortes na base de dados usando a função cut</span></span>
<span id="cb37-5"><a href="mapas-municipais.html#cb37-5" aria-hidden="true" tabindex="-1"></a>boulos_final<span class="sc">$</span>int_geom <span class="ot">&lt;-</span> <span class="fu">cut</span>(boulos_final<span class="sc">$</span>votos_cand_porc, cortes, </span>
<span id="cb37-6"><a href="mapas-municipais.html#cb37-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">include.lowest =</span> T)</span></code></pre></div>
<p>Agora, faremos a visualização de ambos os cortes. Começamos pelo <em>jenks</em>.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="mapas-municipais.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualização do corte jenks</span></span>
<span id="cb38-2"><a href="mapas-municipais.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-3"><a href="mapas-municipais.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>boulos_final, <span class="fu">aes</span>(<span class="at">fill=</span>cortes_jenks))<span class="sc">+</span></span>
<span id="cb38-4"><a href="mapas-municipais.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;RdBu&quot;</span>, <span class="at">name=</span><span class="st">&quot;Votação (%)&quot;</span>)<span class="sc">+</span></span>
<span id="cb38-5"><a href="mapas-municipais.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="fake-book_files/figure-html/graficos-jenks-1.png" width="672" /></p>
<p>O código apresentado logo abaixo gera o mesmo mapa utilizando os cortes <em>geom</em>. Note na legenda que os cortes são consideravelmente diferentes. Isto leva a apresentação de gráficos com cores igualmente diferentes. Compare as diferentes regiões da cidade. É visível que, dependendo do corte, o mapa pode acabar contando uma história diferente. Portanto, é importante refletir antes de decidir qual corte será utilizado. Mais uma vez, não existe solução perfeita.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="mapas-municipais.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualização do corte geom</span></span>
<span id="cb39-2"><a href="mapas-municipais.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-3"><a href="mapas-municipais.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>boulos_final, <span class="fu">aes</span>(<span class="at">fill=</span>int_geom))<span class="sc">+</span></span>
<span id="cb39-4"><a href="mapas-municipais.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;RdBu&quot;</span>, <span class="at">name=</span><span class="st">&quot;Votação (%)&quot;</span>)<span class="sc">+</span></span>
<span id="cb39-5"><a href="mapas-municipais.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="fake-book_files/figure-html/graficos-geom-1.png" width="672" /></p>
<p>Em boa parte dos casos, porém, você vai querer criar uma escala a partir dos resultados observados. Por exemplo, em vez do corte elaborado pela metodologia de intervalos geométricos, que gerou uma categoria variando entre 11,6% e 14,9%, talvez você queira um corte indo de 10,0% até 15,0%. No código abaixo, criamos uma escala manualmente com intervalos de 5 p.p. em 5 p.p., iniciando em 10.</p>
<p>Além disso, incluímos diversos elementos, como título, legenda, escala, e rosa dos ventos. Você poderá ver como modificar cada um destes elementos a partir dos comentários que inserimos no bloco de código. Como você perceberá, o resultado final parece muito mais profissional (e agradável aos olhos) que os mapas gerados nos exercícios anteriores.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="mapas-municipais.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A partir do objeto espacial</span></span>
<span id="cb40-2"><a href="mapas-municipais.html#cb40-2" aria-hidden="true" tabindex="-1"></a>boulos_final  <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="mapas-municipais.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cria uma variável categórica e preenche os níveis que serão a legenda</span></span>
<span id="cb40-4"><a href="mapas-municipais.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-5"><a href="mapas-municipais.html#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">categoria =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-6"><a href="mapas-municipais.html#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(votos_cand_porc) <span class="sc">~</span> <span class="st">&quot;Sem LV&quot;</span>,</span>
<span id="cb40-7"><a href="mapas-municipais.html#cb40-7" aria-hidden="true" tabindex="-1"></a>      votos_cand_porc <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> votos_cand_porc <span class="sc">&lt;=</span> <span class="dv">15</span> <span class="sc">~</span> <span class="st">&quot;10-15%&quot;</span>,</span>
<span id="cb40-8"><a href="mapas-municipais.html#cb40-8" aria-hidden="true" tabindex="-1"></a>      votos_cand_porc <span class="sc">&gt;</span> <span class="dv">15</span> <span class="sc">&amp;</span> votos_cand_porc <span class="sc">&lt;=</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">&quot;15-20%&quot;</span>,</span>
<span id="cb40-9"><a href="mapas-municipais.html#cb40-9" aria-hidden="true" tabindex="-1"></a>      votos_cand_porc <span class="sc">&gt;</span> <span class="dv">20</span> <span class="sc">&amp;</span> votos_cand_porc <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">&quot;20-25%&quot;</span>,</span>
<span id="cb40-10"><a href="mapas-municipais.html#cb40-10" aria-hidden="true" tabindex="-1"></a>      votos_cand_porc <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> votos_cand_porc <span class="sc">&lt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">&quot;25-30%&quot;</span>,</span>
<span id="cb40-11"><a href="mapas-municipais.html#cb40-11" aria-hidden="true" tabindex="-1"></a>      votos_cand_porc <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">&quot;&gt;30%&quot;</span>),</span>
<span id="cb40-12"><a href="mapas-municipais.html#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">categoria =</span> <span class="fu">factor</span>(</span>
<span id="cb40-13"><a href="mapas-municipais.html#cb40-13" aria-hidden="true" tabindex="-1"></a>      categoria,</span>
<span id="cb40-14"><a href="mapas-municipais.html#cb40-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Sem LV&quot;</span>, <span class="st">&quot;10-15%&quot;</span>, <span class="st">&quot;15-20%&quot;</span>, <span class="st">&quot;20-25%&quot;</span>, <span class="st">&quot;25-30%&quot;</span>, <span class="st">&quot;&gt;30%&quot;</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb40-15"><a href="mapas-municipais.html#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inicia o ggplot</span></span>
<span id="cb40-16"><a href="mapas-municipais.html#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb40-17"><a href="mapas-municipais.html#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Usa uma camada de sf</span></span>
<span id="cb40-18"><a href="mapas-municipais.html#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> categoria), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb40-19"><a href="mapas-municipais.html#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retira o datum</span></span>
<span id="cb40-20"><a href="mapas-municipais.html#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb40-21"><a href="mapas-municipais.html#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coloca o fill na paleta de verdes</span></span>
<span id="cb40-22"><a href="mapas-municipais.html#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;YlOrBr&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-23"><a href="mapas-municipais.html#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adicionar título, subtítulo e legenda</span></span>
<span id="cb40-24"><a href="mapas-municipais.html#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-25"><a href="mapas-municipais.html#cb40-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Votação de Guilherme Boulos (2020, 1º turno)&quot;</span>,</span>
<span id="cb40-26"><a href="mapas-municipais.html#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Distritos do município do SP&quot;</span>,</span>
<span id="cb40-27"><a href="mapas-municipais.html#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Fonte: Elaborado por Gelape, Guedes Neto e Faganello (2023), a partir de</span><span class="sc">\n</span><span class="st">dados do TSE, Hidalgo e IBGE.&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-28"><a href="mapas-municipais.html#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adiciona escala</span></span>
<span id="cb40-29"><a href="mapas-municipais.html#cb40-29" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(</span>
<span id="cb40-30"><a href="mapas-municipais.html#cb40-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">width_hint =</span> <span class="fl">0.4</span>, <span class="at">line_width =</span> <span class="fl">0.5</span>, </span>
<span id="cb40-31"><a href="mapas-municipais.html#cb40-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>,<span class="st">&quot;cm&quot;</span>)) <span class="sc">+</span></span>
<span id="cb40-32"><a href="mapas-municipais.html#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coloca título na legenda</span></span>
<span id="cb40-33"><a href="mapas-municipais.html#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">&quot;Votos válidos (%)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb40-34"><a href="mapas-municipais.html#cb40-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajusta elementos do tema do ggplot</span></span>
<span id="cb40-35"><a href="mapas-municipais.html#cb40-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb40-36"><a href="mapas-municipais.html#cb40-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Posição e direção da legenda</span></span>
<span id="cb40-37"><a href="mapas-municipais.html#cb40-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb40-38"><a href="mapas-municipais.html#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb40-39"><a href="mapas-municipais.html#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Centralização de alguns elementos textuais</span></span>
<span id="cb40-40"><a href="mapas-municipais.html#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb40-41"><a href="mapas-municipais.html#cb40-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb40-42"><a href="mapas-municipais.html#cb40-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb40-43"><a href="mapas-municipais.html#cb40-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adiciona rosa-dos-ventos</span></span>
<span id="cb40-44"><a href="mapas-municipais.html#cb40-44" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_north_arrow</span>(</span>
<span id="cb40-45"><a href="mapas-municipais.html#cb40-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">which_north =</span> <span class="st">&quot;true&quot;</span>,</span>
<span id="cb40-46"><a href="mapas-municipais.html#cb40-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>(),</span>
<span id="cb40-47"><a href="mapas-municipais.html#cb40-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ajusta a altura da rosa-dos-ventos (pode exigir tentativa e erro)</span></span>
<span id="cb40-48"><a href="mapas-municipais.html#cb40-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>), <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>)) </span></code></pre></div>
<p><img src="fake-book_files/figure-html/mapa%20final-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="meu-primeiro-mapa.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="atividades-extras.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
